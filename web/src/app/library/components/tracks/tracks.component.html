<div class="wrapper">
  <div class="controls divider fake-scroll-y">
    <button mat-button mat-icon-button class="back" (click)="previous.emit()">
      <mat-icon>arrow_back</mat-icon>
    </button>
    <mat-form-field floatLabel="never" class="search" [class.show]="showSearch">
      <input matInput #searchInput title="Search" [(ngModel)]="search" spellcheck="false">
      <mat-placeholder>
        <mat-icon>search</mat-icon>
        Search a track
      </mat-placeholder>
      <button mat-button *ngIf="search" matSuffix mat-icon-button aria-label="Clear" (click)="search=''">
        <mat-icon>close</mat-icon>
      </button>
    </mat-form-field>
    <div class="controls-meta" [class.show]="!showSearch">
      <span class="select-text">
        Total tracks: {{ tracks.filter(filter).length }}
        </span>
    </div>
    <button mat-button mat-icon-button
            (click)="showSearch = !showSearch; showSearch ? searchInput.focus() : {}"
            class="searchButton">
      <mat-icon>search</mat-icon>
    </button>
    <button mat-button mat-icon-button
            class="more"
            [matMenuTriggerFor]="Track">
      <mat-icon>more_vert</mat-icon>
    </button>
    <mat-menu #Track>
      <button mat-menu-item (click)="library.addTracksToPlaylist(tracks.filter(filter))" [disabled]="tracks.filter(filter).length == 0">
        <mat-icon>playlist_add</mat-icon>
        <span>Add all to current playlist</span>
      </button>
      <!--<button mat-menu-item (click)="library.sortTracks(true)" [disabled]="library.sortTracksAlphabetically">-->
        <!--<mat-icon>sort_by_alpha</mat-icon>-->
        <!--<span>Sort alphabetically</span>-->
      <!--</button>-->
      <!--<button mat-menu-item (click)="library.sortTracks(false)" [disabled]="!library.sortTracksAlphabetically">-->
        <!--<mat-icon>sort</mat-icon>-->
        <!--<span>Sort by file name</span>-->
      <!--</button>-->
    </mat-menu>
  </div>
  <div #list class="list-wrapper" (swiperight)="previous.emit()" (swipeleft)="next.emit()">
    <mat-list class="tracks" [class.sorted-alpha]="library.sortTracksAlphabetically" dense>
      <ng-container *ngFor="let track of tracks.filter(filter).slice(0,300); trackBy: trackByURL">
        <app-track [track]="track"
                   [warn]="track.warn && settings.warnOnMissingTags"
                   [currentTrack]="track.url === (library.currentTrack ? library.currentTrack.url : '')"
                   [search]="search"
                   [playing]="audioService.playing$ | async"
                   [loading]="audioService.loading$ | async"
                   [favorite]="favorites.isFavorite(track)"
                   [currentTime]="audioService.currentTime$ | async"
                   [duration]="audioService.duration$ | async"
                   (click)="library.playTracks(tracks.filter(filter), track); next.emit()"
                   (addToFavorites)="favorites.addToFavorites(track)"
                   (addTrackToPlaylist)="library.addTrackToPlaylist(track)"
                   (audioPause)="pause()"
                   (audioPlay)="play()"
                   (openDetailsDialog)="openDetailsDialog(track)"
                   (playTrack)="library.playTrack(track)"
                   (playTrackNext)="library.playTrackNext(track)"
                   (removeFromFavorites)="favorites.removeFromFavorites(track)">
        </app-track>
      </ng-container>
    </mat-list>
  </div>
  <app-dictionary *ngIf="library.sortTracksAlphabetically" (letterClicked)="scrollTo($event)"></app-dictionary>
</div>
