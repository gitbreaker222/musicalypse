<div class="wrapper">

  <app-chips #chips
             [hidden]="!showChipList"
             [list]="selectedAlbums"
             [displayProperty]="'title'"
             (clickedElement)="scrollTo($event.title)"
             (removedAll)="deselectAll()"
             (removedElement)="deselect($event)">
  </app-chips>

  <app-controls [(search)]="search" [searchPlaceholder]="'Search an album'">
    <span class="select-text" *ngIf="selectedAlbums.length == 0">
      Select an album or
      <mat-chip (click)="library.selectAllAlbums(albums.map(filter))">Select All</mat-chip>
    </span>
    <mat-chip-list>
      <mat-chip *ngFor="let album of selectedAlbums.length <= 2 ? selectedAlbums : selectedAlbums.slice(0,1)"
                (click)="scrollTo(album.title)">
        <span class="chip-text">{{ album.title }}</span>
        <mat-icon matChipRemove (click)="library.deselectAlbum(album)">cancel</mat-icon>
      </mat-chip>
      <mat-chip *ngIf="selectedAlbums.length > 2"
                (click)="showChipList = !showChipList"
                class="chip-more">
        {{ selectedAlbums.length - 1 }} more…
      </mat-chip>
    </mat-chip-list>
  </app-controls>

  <div #list class="list-wrapper" (swiperight)="previous.emit()" (swipeleft)="next.emit()">
    <mat-list class="albums" dense>
      <ng-container *ngFor="let album of albums.map(filter) | async; trackBy: trackByTitle">
        <a class="album hover" (click)="library.selectAlbum(album); next.emit()" mat-list-item>
          <mat-checkbox matListIcon
                        color="primary"
                        [checked]="library.isSelectedAlbum(album)"
                        (change)="$event.checked ? library.addAlbum(album) : library.deselectAlbum(album)"
                        (click)="$event.stopPropagation()"></mat-checkbox>
          <div matListAvatar class="avatar" [style]="getAvatarStyle(album)">
            <mat-icon *ngIf="!album.avatarUrl">music_note</mat-icon>
          </div>
          <div matLine class="primary-text">
            <mat-icon *ngIf="album.warn && settings.warnOnMissingTags" color="warn" matTooltip="Unset tags!">warning</mat-icon>
            <span class="album-name" [innerHtml]="album.title | sgSearch:search"></span>
          </div>
          <div matLine class="secondary-text">
            {{ album.songs }} songs
            <span *ngIf="isMultipleArtistsSelected()">• {{ album.artist }}</span>
          </div>
          <button mat-button mat-icon-button
                  (click)="library.addAlbum(album); next.emit(); $event.stopPropagation()">
            <mat-icon>keyboard_arrow_right</mat-icon>
          </button>
          <mat-divider></mat-divider>
        </a>
      </ng-container>
    </mat-list>
  </div>

  <app-dictionary (letterClicked)="scrollTo($event)"></app-dictionary>

</div>
