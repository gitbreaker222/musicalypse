<div class="wrapper">
  <div class="controls divider">
    <mat-form-field floatLabel="never" class="search">
      <input matInput title="Search" [(ngModel)]="search" (keyup)="filter()" spellcheck="false">
      <mat-placeholder>
        <mat-icon>search</mat-icon>
        Search
      </mat-placeholder>
      <button mat-button *ngIf="search" matSuffix mat-icon-button aria-label="Clear" (click)="search=''; filter()">
        <mat-icon>close</mat-icon>
      </button>
    </mat-form-field>
    <button mat-icon-button
            class="more"
            [matMenuTriggerFor]="Track">
      <mat-icon>more_vert</mat-icon>
    </button>
    <mat-menu #Track>
      <button mat-menu-item (click)="addAllToPlaylist()" [disabled]="filteredTracks.length == 0">
        <mat-icon>playlist_add</mat-icon>
        <span>Add all to current playlist</span>
      </button>
      <button mat-menu-item (click)="sortAlphabetically()">
        <mat-icon>sort_by_alpha</mat-icon>
        <span>Sort alphabetically</span>
      </button>
      <button mat-menu-item (click)="sortByFilename()">
        <mat-icon>sort</mat-icon>
        <span>Sort by file name</span>
      </button>
    </mat-menu>
  </div>
  <mat-list class="tracks">
    <ng-container *ngFor="let track of filteredTracks">
      <a mat-list-item (click)="library.currentTrack == track && audioComponent.playing ? audioComponent.pause() : library.playTracks(tracks, track)">
        <div matLine>
          <mat-icon color="warn" class="favorite-icon" *ngIf="favorites.isFavorite(track)">favorite</mat-icon>
          <span matTooltip="{{track.metadata.title}}" matTooltipShowDelay="1000" [innerHtml]="track.metadata.title | sgSearch:search"></span>
        </div>
        <div matLine class="secondary-text">
          {{track.metadata.duration | sgTime}}
          <span *ngIf="isMultipleAlbumsSelected()">â€¢ {{track.metadata.album}}</span>
        </div>
        <button mat-icon-button
                class="more"
                *ngIf="library.currentTrack != track"
                [matMenuTriggerFor]="trackMenu"
                (click)="$event.stopPropagation()">
          <mat-icon>more_vert</mat-icon>
        </button>
        <mat-menu #trackMenu>
          <button mat-menu-item (click)="library.playTracks(tracks, track)">
            <mat-icon>play_arrow</mat-icon>
            <span>Play</span>
          </button>
          <button mat-menu-item (click)="library.playTrackNext(track)">
            <mat-icon>play_arrow</mat-icon>
            <span>Play next</span>
          </button>
          <button mat-menu-item (click)="addTrackToPlaylist(track)">
            <mat-icon>playlist_add</mat-icon>
            <span>Add to current playlist</span>
          </button>
          <button mat-menu-item [matMenuTriggerFor]="playlistsMenu" disabled>
            <mat-icon>playlist_add</mat-icon>
            <span>Add to playlist</span>
          </button>
          <button mat-menu-item (click)="favorites.addToFavorites(track)" *ngIf="!favorites.isFavorite(track)">
            <mat-icon>favorite_border</mat-icon>
            <span>Add to favorites</span>
          </button>
          <button mat-menu-item (click)="favorites.removeFromFavorites(track)" *ngIf="favorites.isFavorite(track)">
            <mat-icon>favorite</mat-icon>
            <span>Remove from favorites</span>
          </button>
          <button mat-menu-item (click)="openDetailsDialog(track)">
            <mat-icon>details</mat-icon>
            <span>Details</span>
          </button>
        </mat-menu>
        <mat-menu #playlistsMenu="matMenu">
          <button mat-menu-item>
            <mat-icon>add</mat-icon>
            New playlist
          </button>
          <mat-divider></mat-divider>
          <button mat-menu-item>
            <mat-icon>album</mat-icon>
            Playlist1
          </button>
          <button mat-menu-item>
            <mat-icon>album</mat-icon>
            Playlist2
          </button>
        </mat-menu>
        <button mat-icon-button
                class = "playPause"
                *ngIf="library.currentTrack == track"
                (click)="audioComponent.playing ? audioComponent.pause() : audioComponent.play(); $event.stopPropagation()">
          <mat-icon>{{audioComponent.playing ? 'pause' : 'play_arrow'}}</mat-icon>
        </button>
        <span class="spinner" *ngIf="library.currentTrack == track">
          <mat-progress-spinner diameter="40"
                                [mode]="audioComponent.loading ? 'indeterminate' : 'determinate'"
                                [value]="audioComponent.currentTime / audioComponent.duration * 100"></mat-progress-spinner>
        </span>
        <mat-divider></mat-divider>
      </a>
    </ng-container>
  </mat-list>
</div>
